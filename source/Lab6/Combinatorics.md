---
jupytext:
  formats: ipynb,md:myst
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.12
    jupytext_version: 1.9.1
kernelspec:
  display_name: Python 3.7 (XPython)
  language: python
  name: xpython
---

+++ {"slideshow": {"slide_type": "slide"}}

# Combinatorics

+++ {"slideshow": {"slide_type": "-"}, "tags": ["remove-cell"]}

**CS1302 Introduction to Computer Programming**
___

+++ {"slideshow": {"slide_type": "slide"}}

## Permutation using Recursion

+++ {"slideshow": {"slide_type": "subslide"}}

A [$k$-permutation of $n$](https://en.wikipedia.org/wiki/Permutation#k-permutations_of_n) items $a_0,\dots,a_{n-1}$ is an ordered tuple 

$$
(a_{i_0},\dots,a_{i_{k-1}})
$$ 
of $k$ out of the $n$ objects, where $0\leq i_0,\dots,i_{k-1}<n$ are distinct indices. An $n$-permutation of $n$ objects is simply called a permutation of $n$ objects.

+++ {"slideshow": {"slide_type": "fragment"}}

For examples:
- The list of ($3$-)permutations of `1,2,3` is:

```{code-cell}
---
slideshow:
  slide_type: '-'
---
[(1, 2, 3), (1, 3, 2), (2, 1, 3), (2, 3, 1), (3, 1, 2), (3, 2, 1)]
```

+++ {"slideshow": {"slide_type": "fragment"}}

- The list of $2$-permutations of `1,2,3` is:

```{code-cell}
---
slideshow:
  slide_type: '-'
---
[(1, 2), (1, 3), (2, 1), (2, 3), (3, 1), (3, 2)]
```

+++ {"slideshow": {"slide_type": "fragment"}}

In the above, we used
- a `tuple` delimited by `()` such as `(1,2,3)` to store items of a permutation, and 
- a `list` delimited by `[]` such as `[(1, 2, 3), (1, 3, 2), (2, 1, 3), (2, 3, 1), (3, 1, 2), (3, 2, 1)]` to store all the permutations.

+++ {"slideshow": {"slide_type": "subslide"}}

Generating permutations is a fundamental problem in computing and combinatorics.  
A simple way to generate permutations is by recursion. (There are also [other algorithms](https://www.topcoder.com/generating-permutations/).)

+++ {"slideshow": {"slide_type": "fragment"}}

**Recurrence relation (Line 10):**  
- Removing the first element of a $k$-permutation of $n$ objects gives a different $(k-1)$-permutation of the remaining $n-1$ objects.

$$ (a_{i_0}, \underbrace{a_{i_1},\dots,a_{i_{k-1}}}_{\text{($k-1$)-permutation of $a_{i_1},\dots,a_{i_{k-1}}$.}\kern-5em} ) $$
- Reversing the above removal process gives a way of constructing a $k$-permutation from a $(k-1)$-permutation.  
  E.g., the permutations of $1,2,3$ can be constructed as follows:

$$[\overbrace{({\color{red} 1}, {\color{blue}{2, 3}}), ({\color{red} 1}, {\color{blue}{3, 2}})}^{\text{prepend 1 to permutations of $2,3$.} }, \overbrace{({\color{red} 2}, {\color{blue}{1, 3}}), ({\color{red} 2}, {\color{blue}{3, 1}})}^{\text{prepend 2 to permutations of $1,3$.} }, \overbrace{({\color{red} 3}, {\color{blue}{1, 2}}), ({\color{red} 3}, {\color{blue}{2, 1}})}^{\text{prepend 3 to permutations of $1,2$.} }]$$

+++ {"slideshow": {"slide_type": "fragment"}}

The following is an implementation of the recursion `permutation(*a,k=None)` that
- takes in a variable number $n$ of objects as positional arguments (in `a`),
- takes in an integer $k$ using a keyword argument (`k`, with the default `k=None` for $k=n$), and
- returns the list of all $k$-permutations represented as ordered tuples of the $n$ objects.

```{code-cell}
---
slideshow:
  slide_type: '-'
---
def permutation(*a, k=None):
    '''Returns the list of (k-)permutations of the position arguments.'''
    n = len(a)
    output = []
    if k is None:
        k = n
    if 0 < k <= n:
        for i in range(n):
            output.extend([(a[i], ) + p for p in permutation(*a[:i], *a[i + 1:], k=k - 1)])
    elif k == 0:
        return [()]
    return output

print(permutation(1, 2, 3))
print(permutation(1, 2, 3, k=2))
```

+++ {"slideshow": {"slide_type": "fragment"}}

The recurrence is implemented by the for loop:
```Python
        ...
        for i in range(n):
            output.extend([(a[i], ) + p
                           for p in permutation(*a[:i], *a[i + 1:], k=k - 1)])
        ...
```

+++ {"slideshow": {"slide_type": "fragment"}}

In the above code, `(a[i], ) + p` creates a $k$-permutation of the items in `a` by concatenating for each index `i`
- a singleton tuple `(a[i], )` and 
- a $k-1$ permutation `p` of all elements but `a[i]`.

(See the example in the recurrence relation described earlier.)

+++ {"slideshow": {"slide_type": "fragment"}}

Note that:
- The comma in `(a[i], )` is not a typo. Without commas, `(...)` does not create a tuple. 
- `a[:i]` returns a tuple of `a[0]` up to and excluding `a[i]`. `*a[:i]` unpacks the tuple such that its items are separate arguments to `permutation`. 
- Similarly, `*a[i + 1:]` provides items as separate arguments starting from `a[i + 1]` until the last item in `a`.
- `[... for ...]` generates a list of $k$-permutations, and `output.extend([...])` added the list to the end of the `output` list.

+++ {"slideshow": {"slide_type": "subslide"}}

**Exercise** One of the base cases of the recusion happens when $k=0$, in which case there is only one $k$-permutation, namely the empty tuple $()$, and so the function returns `[()]`. There is another base case of the recursion. Explain the condition of that base case and its return value.

+++ {"nbgrader": {"grade": true, "grade_id": "base-case", "locked": false, "points": 1, "schema_version": 3, "solution": true, "task": false}, "slideshow": {"slide_type": "-"}}

When $k<0$ or $k> n$, there is no $k$-permutation and so the function returns an empty list `[]`.

+++ {"slideshow": {"slide_type": "slide"}}

## Number of permutations

+++ {"slideshow": {"slide_type": "fragment"}}

Computing permutations using recursion is slow. Why?  
There are simply too many permutations even for a reasonably small $n$.

```{code-cell}
---
slideshow:
  slide_type: '-'
---
n = 9
output = permutation(*range(1,n+1))
print('# permutations:',len(output))
```

+++ {"slideshow": {"slide_type": "subslide"}}

Surprisingly, the number $P_n$ of ($n-$)permutations of $n$ items can be calculated much faster without enumerating all the permutations. It satisfies the following recurrence:

$$
P_n = \begin{cases}
n P_{n-1} & n>0\\
1 & n=0\\
0 & \text{otherwise.}
\end{cases}
$$

This quantity is fundamental in the field of [combinatorics](https://en.wikipedia.org/wiki/Combinatorics) with enormous applications.

+++ {"slideshow": {"slide_type": "fragment"}}

**Exercise** Implement the above recurrence equation as a recursion `num_permutation(n)` which
- takes in an integer `n`, and
- returns the number of permutations of `n` items.

*Hint: Ensure all base cases are covered, and can run efficiently for large $n$.*

```{code-cell}
---
nbgrader:
  grade: false
  grade_id: num_permutations
  locked: false
  schema_version: 3
  solution: true
  task: false
slideshow:
  slide_type: '-'
---
def num_permutation(n):
    ### BEGIN SOLUTION
    if n > 0:
        return n * num_permutation(n - 1)
    else:
        return 0 if n else 1
    ### END SOLUTION
```

```{code-cell}
---
code_folding: [0]
nbgrader:
  grade: true
  grade_id: test-num_permutations
  locked: true
  points: 1
  schema_version: 3
  solution: false
  task: false
slideshow:
  slide_type: '-'
---
# tests
assert num_permutation(10) == 3628800
assert num_permutation(0) == 1
assert num_permutation(-1) == 0
### BEGIN HIDDEN TESTS
assert num_permutation(123) == 12146304367025329675766243241881295855454217088483382315328918161829235892362167668831156960612640202170735835221294047782591091570411651472186029519906261646730733907419814952960000000000000000000000000000
### END HIDDEN TESTS
```

+++ {"slideshow": {"slide_type": "subslide"}}

**Exercise** Extend the function to `num_permutation(n,k=None)` which
- takes in an additional optional keyword argument `k`, and
- returns the INTEGER number of `k`-permutations of `n` items.

The number is given by the formula

$$P_{n,k} = \begin{cases}
\frac{P_n}{P_{n-k}} & 0\leq k \leq n\\
0 & \text{otherwise.}
\end{cases}$$

```{code-cell}
---
nbgrader:
  grade: false
  grade_id: num_permutation_k
  locked: false
  schema_version: 3
  solution: true
  task: false
---
def num_permutation(n,k=None):
    ### BEGIN SOLUTION
    def f(n):
        return n*f(n-1) if n>0 else 1
    if k is None: # CANNOT use: k = k or None   because k can be 0.
        k = n
    if 0 <= k <= n:
        return f(n) // f(n-k) 
        # CANNOT use: return num_permutation(n) // num_permutation(n-k)
    else:
        return 0
    ### END SOLUTION
```

```{code-cell}
---
code_folding: []
nbgrader:
  grade: true
  grade_id: test-num_permutation_k
  locked: true
  points: 1
  schema_version: 3
  solution: false
  task: false
---
# tests
assert isinstance(num_permutation(0), int)
assert num_permutation(3) == 6
assert num_permutation(3,0) == 1
assert num_permutation(3,2) == 6
assert num_permutation(10,5) == 30240
### BEGIN HIDDEN TESTS
assert num_permutation(123,60) == 6126426623277607558830892659050738012468992831594946549976844836830737333775846630022365422877182368153600000000000000
### END HIDDEN TESTS
```

+++ {"slideshow": {"slide_type": "slide"}}

## Permutation using Iteration

+++ {"slideshow": {"slide_type": "subslide"}}

The following function `permutation_sequence(*a)` returns a generator that generates the list of $k$-permutations one-by-one for $k$ from $0$ to `len(a)`.

```{code-cell}
---
slideshow:
  slide_type: '-'
---
def permutation_sequence(*a):
    '''Returns a generator for the k-permuations of the positional arguments
    for k from 0 to len(a).'''
    n = len(a)
    output, idx_left = [()], [tuple(range(n))]
    for k in range(0, n + 1):
        yield output
        next_output, next_idx_left = [], []
        for m in range(len(idx_left)):
            for j in range(len(idx_left[m])):
                i = idx_left[m][j]
                next_output.append(output[m] + (a[i], ))
                next_idx_left.append(idx_left[m][:j] + idx_left[m][j + 1:])
        output, idx_left = next_output, next_idx_left


for permutation_list in permutation_sequence(1, 2, 3):
    print(permutation_list)
```

```{code-cell}
a=tuple(range(3))
print(a)
```

+++ {"slideshow": {"slide_type": "fragment"}}

Unlike the recursion `permutation`, the above generates a $k$-permutation $(a_{i_0},\dots,a_{i_{k-1}})$ of $n$ object iteratively by 
- choosing $i_j$ for $j$ from $0$ to $k-1$ such that
- $i_j$ is not already chosen, i.e., $i_j\not\in \{i_0,\dots,i_{j-1}\}$.

+++ {"slideshow": {"slide_type": "fragment"}}

E.g., the permutations of $1,2,3$ is generated iteratively as follows:
- 1
 - 1,2
   - **(1,2,3)**
 - 1,3
   - **(1,3,2)**
- 2
 - 2,1
   - **(2,1,3)**
 - 2,3
   - **(2,3,1)**
- 3
 - 3,1
   - **(3,1,2)**
 - 3,2
   - **(3,2,1)**

+++ {"slideshow": {"slide_type": "fragment"}}

**Invariance maintained at the beginning of iteration:**
- `output` is the list of $k$-permutations, and
- `idx_left[m]` is the list of indices of arguments not yet in `output[m]`. 

A $(k+1)$-permutation (in `next_output`) can then be generated by (Line 10) appending an argument (with an index from `idx_left`) to a $k$-permutation (in `output`).

+++ {"slideshow": {"slide_type": "subslide"}}

Is iteration significantly faster?

```{code-cell}
---
slideshow:
  slide_type: '-'
---
n = 9
for k, permutation_list in enumerate(permutation_sequence(*range(1,n+1))):
    print('# {}-permutations of {} items: {}'.format(k, n, len(permutation_list)))
```

+++ {"slideshow": {"slide_type": "fragment"}}

Unfortunately, there is not much improvement. Nevertheless, we can efficiently compute the number of $k$-permutations based on the previously computed number of $k-1$-permutations:

For $k$ from $0$ to $n$,

$$
P_{n,k} = \underbrace{\overbrace{n\times  (n-1)\times \cdots }^{P_{n,k-1}\text{  if }k>0}\times(n-k+1)}_{\text{$k$ terms in the product.}}.$$

+++ {"slideshow": {"slide_type": "subslide"}}

**Exercise** Use the `yield` statement to write the function `num_permutation_sequence(n)` that returns a generator of $P_{n,k}$ with `k` from `0` to `n`.

```{code-cell}
---
nbgrader:
  grade: false
  grade_id: num_permutation_sequence
  locked: false
  schema_version: 3
  solution: true
  task: false
slideshow:
  slide_type: '-'
---
def num_permutation_sequence(n):
    output = 1
    for k in range(0, n + 1):
        ### BEGIN SOLUTION
        yield output
        output = output * (n - k)
        ### END SOLUTION
```

```{code-cell}
---
code_folding: [4]
nbgrader:
  grade: true
  grade_id: test-num_permutation_sequence
  locked: true
  points: 1
  schema_version: 3
  solution: false
  task: false
slideshow:
  slide_type: '-'
---
# tests
assert [m for m in num_permutation_sequence(3)] == [1, 3, 6, 6]
assert [m for m in num_permutation_sequence(10)] == [1, 10, 90, 720, 5040, 30240, 151200, 604800, 1814400, 3628800, 3628800]
### BEGIN HIDDEN TESTS
assert [m for m in num_permutation_sequence(123)] == [1,
 123,
 15006,
 1815726,
 217887120,
 25928567280,
 3059570939040,
 357969799867680,
 41524496784650880,
 4775317130234851200,
 544386152846773036800,
 61515635271685353158400,
 6889751150428759553740800,
 764762377697592310465228800,
 84123861546735154151175168000,
 9169500908594131802478093312000,
 990306098128166234667634077696000,
 105962752499713787109436846313472000,
 11232051764969661433600305709228032000,
 1179365435321814450528032099468943360000,
 122654005273468702854915338344770109440000,
 12633362543167276394056279849511321272320000,
 1288602979403062192193740544650154769776640000,
 130148900919709281411567795009665631747440640000,
 13014890091970928141156779500966563174744064000000,
 1288474119105121885974521170595689754299662336000000,
 126270463672301944825503074718377595921366908928000000,
 12248234976213288648073798247682626804372590166016000000,
 1175830557716475710215084631777532173219768655937536000000,
 111703902983065192470433040018865556455878022314065920000000,
 10500166880408128092220705761773362306852534097522196480000000,
 976515519877955912576525635844922694537285671069564272640000000,
 89839427828771943957040358497732887897430281738399913082880000000,
 8175387932418246900090672623293692798666155638194392090542080000000,
 735784913917642221008160536096432351879954007437495288148787200000000,
 65484857338670157669726287712582479317315906661937080645242060800000000,
 5762667445802973874935913318707258179923799786250463096781301350400000000,
 501352067784858727119424458727531461653370581403790289419973217484800000000,
 43116277829497850532270503450567705702189870000725964890117696703692800000000,
 3664883615507317295242992793298254984686138950061707015660004219813888000000000,
 307850223702614652800411394637053418713635671805183389315440354464366592000000000,
 25551568567317016182434145754875433753231760759830221313181549420542427136000000000,
 2095228622519995326959599951899785567765004382306078147680887052484479025152000000000,
 169713518424119621483727596103882630988965354966792329962151851251242801037312000000000,
 13577081473929569718698207688310610479117228397343386396972148100099424082984960000000000,
 1072589436440436007777158407376538227850261043390127525360799699907854502555811840000000000,
 83661976042354008606618355775369981772320361384429946978142376592812651199353323520000000000,
 6441972155261258662709613394703488596468667826601105917316962997646574142350205911040000000000,
 489589883799855658365930617997465133331618754821684049716089187821139634818615649239040000000000,
 36719241284989174377444796349809884999871406611626303728706689086585472611396173692928000000000000,
 2717223855089198903930914929885931489990484089260346475924294992407324973243316853276672000000000000,
 198357341421511519986956789881672998769305338516005292742473534445734723046762130289197056000000000000,
 14281728582348829439060888871480455911389984373152381077458094480092900059366873380822188032000000000000,
 1014002729346766890173323109875112369708688890493819056499524708086595904215048010038375350272000000000000,
 70980191054273682312132617691257865879608222334567333954966729566061713295053360702686274519040000000000000,
 4897633182744884079537150620696792745692967341085146042892704340058258217358681888485352941813760000000000000,
 333039056426652117408526242207381906707121779193789930916703895123961558780390368417004000043335680000000000000,
 22313616780585691866371258227894587749377159205983925371419160973305424438286154683939268002903490560000000000000,
 1472698707518655663180503043041042791458892507594939074513664624238158012926886209139991688191630376960000000000000,
 95725415988712618106732697797667781444828012993671039843388200575480270840247603594099459732455974502400000000000000,
 6126426623277607558830892659050738012468992831594946549976844836830737333775846630022365422877182368153600000000000000,
 385964877266489276206346237520196494785546548390481632648541224720336452027878337691409021641262489193676800000000000000,
 23929822390522335124793466726252182676703886000209861224209555932660860025728456936867359341758274330007961600000000000000,
 1459719165821862442612401470301383143278937046012801534676782911892312461569435873148908919847254734130485657600000000000000,
 87583149949311746556744088218082988596736222760768092080606974713538747694166152388934535190835284047829139456000000000000000,
 5167405847009393046847901204866896327207437142885317432755811508098786113955802990947137576259281758821919227904000000000000000,
 299709539126544796717178269882279986978031354287348411099837067469729594609436573474933979423038342011671315218432000000000000000,
 17083443730213053412879161383289959257747787194378859432690712845774586892737884688071236827113185494665264967450624000000000000000,
 956672848891930991121233037464237718433876082885216128230679919363376865993321542531989262318338387701254838177234944000000000000000,
 52617006689056204511667817060533074513863184558686887052687395564985727629632684839259409427508611323569016099747921920000000000000000,
 2841318361209035043630062121268786023748611966169091900845119360509229292000164981320008109085465011472726869386387783680000000000000000,
 150589873144078857312393292427245659258676434206961870744791326106989152476008744009960429781529645608054524077478552535040000000000000000,
 7830673403492100580244451206216774281451174578762017278729148957563435928752454688517942348639541571618835252028884731822080000000000000000,
 399364343578097129592467011517055488354009903516862881215186596835735232366375189114415059780616620152560597853473121322926080000000000000000,
 19968217178904856479623350575852774417700495175843144060759329841786761618318759455720752989030831007628029892673656066146304000000000000000000,
 978442641766337967501544178216785946467324263616314058977207162247551319297619213330316896462510719373773464741009147241168896000000000000000000,
 46965246804784222440074120554405725430431564653583074830905943787882463326285722239855211030200514529941126307568439067576107008000000000000000000,
 2207366599824858454683483666057069095230283538718404517052579358030475776335428945273194918419424182907232936455716636176077029376000000000000000000,
 101538863591943488915440248638625178380593042781046607784418650469401885711429731482566966247293512413732715076962965264099543351296000000000000000000,
 4569248861637457001194811188738133027126686925147097350298839271123084857014337916715513481128208058617972178463333436884479450808320000000000000000000,
 201046949912048108052571692304477853193574224706472283413148927929415733708630868335482593169641154579190775852386671222917095835566080000000000000000000,
 8645018846218068646260582769092547687323691662378308186765403900964876549471127338425751506294569646905203361652626862585435120929341440000000000000000000,
 363090791541158883142944476301887002867595049819888943844146963840524815077787348213881563264371925170018541189410328228588275079032340480000000000000000000,
 14886722453187514208860723528377367117571397042615446697610025517461517418189281276769144093839248931970760188765823457372119278240325959680000000000000000000,
 595468898127500568354428941135094684702855881704617867904401020698460696727571251070765763753569957278830407550632938294884771129613038387200000000000000000000,
 23223287026972522165822728704268692703411379386480096848271639807239967172375278791759864786389228333874385894474684593500506074054908497100800000000000000000000,
 882484907024955842301263690762210322729632416686243680234322312675118752550260594086874861882790676687226663990038014553019230814086522889830400000000000000000000,
 32651941559923366165146756558201781940996399417391016168669925568979393844359641981214369889663255037427386567631406538461711540121201346923724800000000000000000000,
 1175469896157241181945283236095264149875870379026076582072117320483258178396947111323717316027877181347385916434730635384621615444363248489254092800000000000000000000,
 41141446365503441368084913263334245245655463265912680372524106216914036243893148896330106060975701347158507075215572238461756540552713697123893248000000000000000000000,
 1398809176427117006514887050953364338352285751041031132665819611375077232292367062475223606073173845803389240557329456107699722378792265702212370432000000000000000000000,
 46160702822094861214991272681461023165625429784354027377972047175377548665648113061682379000414736911511844938391872051554090838500144768173008224256000000000000000000000,
 1477142490307035558879720725806752741300013753099328876095105509612081557300739617973836128013271581168379038028539905649730906832004632581536263176192000000000000000000000,
 45791417199518102325271342500009334980300426346079195158948270797974528276322928157188919968411419016219750178884737075141658111792143610027624158461952000000000000000000000,
 1373742515985543069758140275000280049409012790382375854768448123939235848289687844715667599052342570486592505366542112254249743353764308300828724753858560000000000000000000000,
 39838532963580749022986067975008121432861370921088899788284995594237839600400947496754360372517934544111182655629721255373242557259164940724033017861898240000000000000000000000,
 1115478922980260972643609903300227400120118385790489194071979876638659508811226529909122090430502167235113114357632195150450791603256618340272924500133150720000000000000000000000,
 30117930920467046261377467389106139803243196416343208239943456669243806737903116307546296441623558515348054087656069269062171373287928695187368961503595069440000000000000000000000,
 783066203932143202795814152116759634884323106824923414238529873400338975185481023996203707482212521399049406279057800995616455705486146074871592999093471805440000000000000000000000,
 19576655098303580069895353802918990872108077670623085355963246835008474379637025599905092687055313034976235156976445024890411392637153651871789824977336795136000000000000000000000000,
 469839722359285921677488491270055780930593864094954048543117924040203385111288614397722224489327512839429643767434680597369873423291687644922955799456083083264000000000000000000000000,
 10806313614263576198582235299211282961403658874183943116491712252924677857559638131147611163254532795306881806650997653739507088735708815833227983387489910915072000000000000000000000000,
 237738899513798676368809176582648225150880495232046748562817669564342912866312038885247445591599721496751399746321948382269155952185593948331015634524778040131584000000000000000000000000,
 4992516889789772203744992708235612728168490399872981719819171060851201170192552816590196357423594151431779394672760916027652274995897472914951328325020338842763264000000000000000000000000,
 99850337795795444074899854164712254563369807997459634396383421217024023403851056331803927148471883028635587893455218320553045499917949458299026566500406776855265280000000000000000000000000,
 1897156418120113437423097229129532836704026351951733053531285003123456444673170070304274615820965777544076169975649148090507864498441039707681504763507728760250040320000000000000000000000000,
 34148815526162041873615750124331591060672474335131194963563130056222216004117061265476943084777383995793371059561684665629141560971938714738267085743139117684500725760000000000000000000000000,
 580529863944754711851467752113637048031432063697230314380573210955777672069990041513108032441215527928487308012548639315695406536522958150550540457633365000636512337920000000000000000000000000,
 9288477823116075389623484033818192768502913019155685030089171375292442753119840664209728519059448446855796928200778229051126504584367330408808647322133840010184197406720000000000000000000000000,
 139327167346741130844352260507272891527543695287335275451337570629386641296797609963145927785891726702836953923011673435766897568765509956132129709832007600152762961100800000000000000000000000000,
 1950580342854375831820931647101820481385611734022693856318725988811412978155166539484042989002484173839717354922163428100736565962717139385849815937648106402138681455411200000000000000000000000000,
 25357544457106885813672111412323666258012952542295020132143437854548368716017165013292558857032294259916325613988124565309575357515322812016047607189425383227802858920345600000000000000000000000000,
 304290533485282629764065336947883995096155430507540241585721254254580424592205980159510706284387531118995907367857494783714904290183873744192571286273104598733634307044147200000000000000000000000000,
 3347195868338108927404718706426723946057709735582942657442933796800384670514265781754617769128262842308954981046432442620863947192022611186118284149004150586069977377485619200000000000000000000000000,
 33471958683381089274047187064267239460577097355829426574429337968003846705142657817546177691282628423089549810464324426208639471920226111861182841490041505860699773774856192000000000000000000000000000,
 301247628150429803466424683578405155145193876202464839169864041712034620346283920357915599221543655807805948294178919835877755247282035006750645573410373552746297963973705728000000000000000000000000000,
 2409981025203438427731397468627241241161551009619718713358912333696276962770271362863324793772349246462447586353431358687022041978256280054005164587282988421970383711789645824000000000000000000000000000,
 16869867176424068994119782280390688688130857067338030993512386335873938739391899540043273556406444725237133104474019510809154293847793960378036152110980918953792685982527520768000000000000000000000000000,
 101219203058544413964718693682344132128785142404028185961074318015243632436351397240259641338438668351422798626844117064854925763086763762268216912665885513722756115895165124608000000000000000000000000000,
 506096015292722069823593468411720660643925712020140929805371590076218162181756986201298206692193341757113993134220585324274628815433818811341084563329427568613780579475825623040000000000000000000000000000,
 2024384061170888279294373873646882642575702848080563719221486360304872648727027944805192826768773367028455972536882341297098515261735275245364338253317710274455122317903302492160000000000000000000000000000,
 6073152183512664837883121620940647927727108544241691157664459080914617946181083834415578480306320101085367917610647023891295545785205825736093014759953130823365366953709907476480000000000000000000000000000,
 12146304367025329675766243241881295855454217088483382315328918161829235892362167668831156960612640202170735835221294047782591091570411651472186029519906261646730733907419814952960000000000000000000000000000,
 12146304367025329675766243241881295855454217088483382315328918161829235892362167668831156960612640202170735835221294047782591091570411651472186029519906261646730733907419814952960000000000000000000000000000]
### END HIDDEN TESTS
```

+++ {"slideshow": {"slide_type": "subslide"}}

**Exercise (Challenge)** Extend the function `num_permutation_sequence(n)` so that calling `send(0)` method causes the generator to increment $n$ instead of $k$ for the next number to generate. i.e., for $0\leq k \leq n$,

$$\dots P_{n,k-1}\to P_{n,k} \xrightarrow{\text{send(0)}} P_{n+1,k} \to P_{n+1,k+1}\dots$$
where $\to$ without labels is the normal transition without calling the `send` method.

*Hint:*

$$P_{n+1,k}=P_{n,k} \times \frac{n+1}{n-k+1}.$$

```{code-cell}
---
nbgrader:
  grade: false
  grade_id: num_permutation_sequence_send
  locked: false
  schema_version: 3
  solution: true
  task: false
slideshow:
  slide_type: '-'
---
def num_permutation_sequence(n):
    ### BEGIN SOLUTION
    output = 1
    k = 0
    while k <= n:
        if (yield output) == 0:
            output = (n+1) * output // (n-k + 1)
            n += 1
        else:
            output = output * (n-k)
            k += 1
    ### END SOLUTION
```

```{code-cell}
---
code_folding: []
nbgrader:
  grade: true
  grade_id: test-num_permutation_sequence_send
  locked: true
  points: 1
  schema_version: 3
  solution: false
  task: false
slideshow:
  slide_type: '-'
---
# tests
g = num_permutation_sequence(3)
assert (next(g), next(g), g.send(0), next(g), next(g), next(g), g.send(0)) == (1, 3, 4, 12, 24, 24, 120)
### BEGIN HIDDEN TESTS
g = num_permutation_sequence(5)
assert (next(g), next(g), next(g), g.send(0), next(g), next(g), next(g), next(g), g.send(0)) == (1, 5, 20, 30, 120, 360, 720, 720, 5040)
### END HIDDEN TESTS
```

+++ {"slideshow": {"slide_type": "slide"}}

## Deduplication using Decorator

+++ {"slideshow": {"slide_type": "subslide"}}

An issue with the function `permutation` is that it regards arguments at different positions as distinct even if they may have the same value. E.g.,  
`permutation(1,1,2)` returns `[(1, 1, 2), (1, 2, 1), (1, 1, 2), (1, 2, 1), (2, 1, 1), (2, 1, 1)]`  
where each distinct permutation appears twice.

+++ {"slideshow": {"slide_type": "fragment"}}

To remove duplicates from a list, we can 
- convert the list to a `set` (which automatically remove duplicates),
- and then convert the set back to a list.

```{code-cell}
---
slideshow:
  slide_type: fragment
---
print('Deduplicated:',list(set(permutation(1,1,2))))
```

+++ {"slideshow": {"slide_type": "subslide"}}

Using a decorator, we can fix `permutation` without rewriting the function.

```{code-cell}
---
slideshow:
  slide_type: fragment
---
import functools


def deduplicate_output(f):
    '''Takes in a function f that returns a list possibly with duplicates,
    returns a decorator that remove duplicates from the output list.'''
    @functools.wraps(f)
    def wrapper(*args, **kwargs):
        return list(set(f(*args, **kwargs)))

    return wrapper


permutation = deduplicate_output(permutation)
print('Deduplicated: ', permutation(1, 1, 2))
permutation = permutation.__wrapped__
print('Original: ', permutation(1, 1, 2))
```

+++ {"slideshow": {"slide_type": "subslide"}}

**Exercise:** Create a decorator to eliminate duplicate input positional arguments instead of the ouput, i.e.,  
`permutation(1,1,2)` will return the same result as `permutation(1,2)`.

```{code-cell}
---
nbgrader:
  grade: false
  grade_id: deduplicate_input
  locked: false
  schema_version: 3
  solution: true
  task: false
slideshow:
  slide_type: '-'
---
def deduplicate_input(f):
    '''Takes in a function f that takes a variable number of arguments 
    possibly with duplicates, returns a decorator that remove duplicates 
    in the positional argument.'''
    @functools.wraps(f)
    def wrapper(*args, **kwargs):
        ### BEGIN SOLUTION
        args = list(set(args))
        return f(*args, **kwargs)
        ### END SOLUTION

    return wrapper
```

```{code-cell}
---
code_folding: []
nbgrader:
  grade: true
  grade_id: test-deduplicate_input
  locked: true
  points: 1
  schema_version: 3
  solution: false
  task: false
slideshow:
  slide_type: '-'
solution: hidden
---
# tests
permutation = deduplicate_input(permutation)
assert set(permutation(1,1,2)) == set([(1, 2), (2, 1)])
### BEGIN HIDDEN TESTS
assert set(permutation(1,2,2,3,3,3,4,4)) == set([(1, 2, 3, 4), (1, 2, 4, 3), (1, 3, 2, 4), (1, 3, 4, 2), (1, 4, 2, 3), (1, 4, 3, 2), (2, 1, 3, 4), (2, 1, 4, 3), (2, 3, 1, 4), (2, 3, 4, 1), (2, 4, 1, 3), (2, 4, 3, 1), (3, 1, 2, 4), (3, 1, 4, 2), (3, 2, 1, 4), (3, 2, 4, 1), (3, 4, 1, 2), (3, 4, 2, 1), (4, 1, 2, 3), (4, 1, 3, 2), (4, 2, 1, 3), (4, 2, 3, 1), (4, 3, 1, 2), (4, 3, 2, 1)])
### END HIDDEN TESTS
permutation = permutation.__wrapped__
```
